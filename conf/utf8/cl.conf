# -*- perl -*-
### ãƒ¦ãƒ¼ã‚¶è¨­å®šé …ç›® ###

# --------------------------------------------------------------------
# æ—¥è¨˜ã®åå‰
$changelog_name = "ChangeLog";

# --------------------------------------------------------------------
# ChangeLog ã‚’å…¬é–‹ã™ã‚‹ URL (çµ¶å¯¾ URL ã‚’å¼·ãæ¨å¥¨) - RSS ã«å¿…è¦
# ä¾‹: $clog_url = "http://nais.to/~yto/clog/";
$clog_url = ".";		# å¿…ãš URL ã‚’è¨­å®šã—ã¦ä¸‹ã•ã„

# --------------------------------------------------------------------
# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¸ (index.html) ã§æœ€è¿‘ä½•æ—¥åˆ†ã‚’è¡¨ç¤ºã™ã‚‹ã‹
# (ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ "-n" ã§ã‚‚æŒ‡å®šã§ãã¾ã™)
$opt_topn = 7;

# --------------------------------------------------------------------
# æ—¥ã”ã¨ã«ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹ã‹ (0:NO, 1:YES) --- obsolete
#$day_page_mode = 1;

# --------------------------------------------------------------------
# ä½œæˆã™ã‚‹ãƒšãƒ¼ã‚¸ã®å˜ä½ (0:æœˆ, 1:æ—¥, 2:ã‚¢ã‚¤ãƒ†ãƒ )
$page_mode = 2;

# --------------------------------------------------------------------
# è‡ªå‹•æ–‡å­—åˆ—ç½®æ›
$auto_replace = '
s!(<blockquote>)!</p>$1!g;
s!(</blockquote>)!$1<p>!g;
s!(chalow)(<|\s|[\x80-\xff]|$)!<a href="http://nais.to/~yto/tools/chalow/">$1</a>$2!g;
';

# --------------------------------------------------------------------
# ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€åˆã«å‡ºã¦ãã‚‹ã€Œ<!-- ReplaceOnce -->ã€ã‚’ç½®ãæ›ãˆã‚‹æ–‡å­—åˆ—
$replace_once = << "__REPLACE_ONCE"
<!-- åºƒå‘Šã¨ã‹ -->
__REPLACE_ONCE
    ;

# --------------------------------------------------------------------
# CSS ãƒ•ã‚¡ã‚¤ãƒ«
$css_file = "diary.css";
#$css_file = "clover/clover.css";

# --------------------------------------------------------------------
# æ—¥ä»˜ã®å¾Œã«æ›œæ—¥(Mon, Tue, ...)ã‚’è¡¨ç¤ºã™ã‚‹ã‹ (1:yes or 0:no)
$show_day_of_week = 1;

# --------------------------------------------------------------------
# æœˆãƒšãƒ¼ã‚¸ã§ã€æ—¥ä»˜ã‚’é™é † (æ–°ã—ã„æ—¥ä»˜ãŒä¸Š) ã§è¡¨ç¤ºã™ã‚‹ã‹ (1:yes or 0:no)
$reverse_order_days = 1;

# --------------------------------------------------------------------
# ã‚¢ã‚¤ãƒ†ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ã©ã†ã™ã‚‹ã‹
# (0:"* HOGE:", 1:"* HOGE", 2:"HOGE:",3:"HOGE")
$item_header_style = 1;

# --------------------------------------------------------------------
# è¡¨ç¤ºã™ã‚‹ã¨ãå¼•ç”¨è¨˜å· ('>' or '|') ã‚’æ¶ˆã™ã‹ (1:YES, 0:NO)
$remove_quote_mark = 1;

# --------------------------------------------------------------------
# item header ã§ h3 ã‚¿ã‚°ã‚’ä½¿ã†ã‹ (1:YES, 0:NO) - tDiary ã¨ã®äº’æ›æ€§ã®ãŸã‚
$use_h3_for_item_header = 1;

# --------------------------------------------------------------------
# item header ã®å…ˆé ­ã®è¨˜å·ã«ã‚¢ãƒ³ã‚«ãƒ¼ã‚’ã¤ã‘ã‚‹ã‹ (1:YES, 0:NO)
$use_item_anchor = 1;

# --------------------------------------------------------------------
# item header ã®å…ˆé ­ã®è¨˜å·ã®æŒ‡å®š
# ã€æ—¥è¨˜ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å…ˆé ­(ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã®è¡Œé ­)ã«æŒ¿å…¥ã•ã‚Œã‚‹ã€ãƒªãƒ³ã‚¯ç”¨ã®
# ã‚¢ãƒ³ã‚«ãƒ¼æ–‡å­—åˆ—ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãªãŠã€Œ<span class="panchor">_</span>ã€ã‚’
# æŒ‡å®šã™ã‚‹ã¨ã€ãƒ†ãƒ¼ãƒã«ã‚ˆã£ã¦ã¯è‡ªå‹•çš„ã«ç”»åƒã‚¢ãƒ³ã‚«ãƒ¼ãŒã¤ãã‚ˆã†ã«ãªã‚Šã¾
# ã™ã€‚ã€(tDiary ã® skel/conf.rhtml ã‚ˆã‚Š)
$item_header_mark = qq(<span class="sanchor">â– </span>);

# --------------------------------------------------------------------
# RSS ã‚’å‡ºåŠ›ã™ã‚‹ã‹ (1:YES, 0:NO)
$output_rss = 1;

# --------------------------------------------------------------------
# æ—¥è¨˜ã®èª¬æ˜ for RSS : ä¾‹: "æ—¥ã€…ã®ã‚ã‚Œã“ã‚Œã€‚"
$changelog_description = "æ—¥ã€…ã®ã‚ã‚Œã“ã‚Œã€‚";

# --------------------------------------------------------------------
# ä»–ã®å¹´ã®åŒã˜æ—¥ä»˜ (æœˆæ—¥) ã¸ã®ãƒªãƒ³ã‚¯ã‚’å¼µã‚‹ã‹ (1:YES, 0:NO)
$same_date_jump = 1;

# --------------------------------------------------------------------
# æ—¥ä»˜ä¸€è¦§ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã«ã™ã‚‹ã‹ (1:YES, 0:NO)
$calendar_style = 0;

# --------------------------------------------------------------------
# æ¤œç´¢ç”¨ãƒ•ã‚¡ã‚¤ãƒ« (cl.itemlist) ã‚’ä½œã‚‹ã‹ (1:YES, 0:NO)
$output_itemlist = 1;

# --------------------------------------------------------------------
# è¦‹å‡ºã—ä¸€è¦§ (JavaScript ãƒ•ã‚¡ã‚¤ãƒ«) ã§å‡ºåŠ›ã™ã‚‹æ—¥æ•°
$latest_titles_num = 10;

# --------------------------------------------------------------------
# ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹ã‹ (0:NO, 1:YES)
$output_cat_pages = 0;

# --------------------------------------------------------------------
# ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ä¸­ã®ã‚¨ãƒ³ãƒˆãƒªæ•°ã®ä¸Šé™
# ($output_cat_pages = 1 ã®ã¨ãã®ã¿æœ‰åŠ¹)
$cat_page_entry_max = 20;

# --------------------------------------------------------------------
# ã‚«ãƒ†ã‚´ãƒªåˆ¥itemè¡¨ç¤ºã®ãŸã‚ã®CGIã‚’æŒ‡å®šã™ã‚‹ï¼ˆã‚«ãƒ†ã‚´ãƒªåã¯ %%CAT%% ã§ç½®ãæ›ãˆï¼‰
# ($output_cat_pages = 0 ã®ã¨ãã®ã¿æœ‰åŠ¹)
$cat_page_cgi = "clsearch.cgi?cat=%%CAT%%";
#$cat_page_cgi = "";


######################################################################
## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

# (ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼)
my $side_menu = << "___SIDE_MENU"
<div class="funcbox" title="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯è¤‡æ•°æŒ‡å®šã§ãã¾ã™">
<FORM METHOD="GET" ACTION="clsearch.cgi" style="margin:0;padding:0">
ChangeLogã‚’æ¤œç´¢<br>
<INPUT TYPE="text" NAME="key" size="10">
<input type="checkbox" name="mode" value="1" checked>
<INPUT TYPE="submit" NAME=".submit" VALUE="ok">
</FORM>
</div>
<div class="funcbox">
<a href="clkeitai.cgi">æºå¸¯é›»è©±ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ï¼</a>
</div>
<p/>

<div class="stdbox">
<table>
<tr><td>ã‚«ãƒ†ã‚´ãƒª</td></tr>
<tr><td><TMPL_VAR name=category_list></td></tr>
<!--<tr><td><script language="JavaScript" src="cl-cat.js"></script></td></tr>-->
</table>
</div>
<p/>

<div class="stdbox">
<table>
<tr><td>æœ€è¿‘ã®è©±é¡Œ</td></tr>
<tr><td><TMPL_VAR name=latest_item_list></script></td></tr>
<!--<tr><td><script language="JavaScript" src="cl.js"></script></td></tr>-->
</table>
</div>
<p/>

<div class="stdbox">
<table><tr><td>ãƒªãƒ³ã‚¯</td></tr><tr><td>
- <a href="http://nais.to/~yto/tools/chalow/">chalow</a><br>
- <a href="http://nais.to/~yto/clog/">ãŸã¤ã‚’ã® ChangeLog</a><br>
</td></tr></table>
</div>
<p/>

<div class="stdbox">
<table>
<tr><td>éå»ãƒ­ã‚°</td></tr>
<tr><td style="font-size:11px;text-align:center">
<TMPL_VAR name=month_page_list>
</td></tr>
</table>
</div>
<p/>
___SIDE_MENU
    ;


# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
$index_page_template = << "___INDEX_PAGE_TEMPLATE"
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<TMPL_IF name=css_file>
<link rel=stylesheet href="<TMPL_VAR name=css_file>" media=all>
</TMPL_IF>
<link rel="alternate" type="application/rss+xml" title="RSS" href="cl.rdf">
<title><TMPL_VAR name=cl_name></title>
</head>
<body>
<p class="adminmenu"><a href="index.html">æœ€æ–°</a> / <a href="cl.rdf">RSS</a></p>
<h1><a href="index.html"><TMPL_VAR name=cl_name></a></h1>

<div id="content">
<p class="calendar"><TMPL_VAR name=ym> / <TMPL_VAR name=day_list></p>

<p>æœ€è¿‘ <TMPL_VAR name=ndays> æ—¥åˆ† / <a href="<TMPL_VAR name=ym>.html">ä»Šæœˆã®ä¸€è¦§</a>
</p>
<TMPL_LOOP name=entries> 
<TMPL_VAR name=content> 
</TMPL_LOOP>
<p class="calendar"><TMPL_VAR name=month_page_list></p>
<p>æœ€çµ‚æ›´æ–°æ™‚é–“: <TMPL_VAR name=lastupdate></p>
</div>

<div id="links">$side_menu</div>
<div id="footer"><TMPL_VAR name=signature></div>
</body></html>
___INDEX_PAGE_TEMPLATE
    ;

# æœˆãƒšãƒ¼ã‚¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
$month_page_template = << "___MONTH_PAGE_TEMPLATE"
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<TMPL_IF name=css_file>
<link rel=stylesheet href="<TMPL_VAR name=css_file>" media=all>
</TMPL_IF>
<link rel="alternate" type="application/rss+xml" title="RSS" href="cl.rdf">
<title><TMPL_VAR name=cl_name> / <TMPL_VAR name=ym></title>
</head>
<body>
<div style="width:750px">
<p class="adminmenu">
<TMPL_IF name=back><a href="<TMPL_VAR name=back>.html">å‰ã®æœˆ</a> / </TMPL_IF>
<TMPL_IF name=next><a href="<TMPL_VAR name=next>.html">æ¬¡ã®æœˆ</a> / </TMPL_IF>
<a href="index.html">æœ€æ–°</a></p>
<h1><a href="index.html"><TMPL_VAR name=cl_name></a> / <TMPL_VAR name=ym></h1>
<p class="calendar"><TMPL_VAR name=day_list></p>
<p class="calendar"><TMPL_VAR name=month_page_list></p>
<TMPL_LOOP name=entries><TMPL_VAR name=content></TMPL_LOOP>
<p class="calendar"><TMPL_VAR name=month_page_list></p>
<p>æœ€çµ‚æ›´æ–°æ™‚é–“: <TMPL_VAR name=lastupdate></p>
<TMPL_VAR name=signature>
</div>
</body></html>
___MONTH_PAGE_TEMPLATE
    ;

# æ—¥ãƒšãƒ¼ã‚¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
$day_page_template = << "___DAY_PAGE_TEMPLATE"
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<TMPL_IF name=css_file>
<link rel=stylesheet href="<TMPL_VAR name=css_file>" media=all>
</TMPL_IF>
<link rel="alternate" type="application/rss+xml" title="RSS" href="cl.rdf">
<title><TMPL_VAR name=cl_name> / <TMPL_VAR name=ymd></title>
</head>
<body>
<div style="width:750px">
<p class="adminmenu">
<TMPL_IF name=back><a href="<TMPL_VAR name=back>.html">å‰ã®æ—¥</a> / </TMPL_IF>
<TMPL_IF name=next><a href="<TMPL_VAR name=next>.html">æ¬¡ã®æ—¥</a> / </TMPL_IF>
<a href="index.html">æœ€æ–°</a> / <a href="<TMPL_VAR name=ym>.html"><TMPL_VAR name=ym></a></p>
<h1><a href="index.html"><TMPL_VAR name=cl_name></a> / <TMPL_VAR name=ymd></h1>
<p class="calendar"><TMPL_VAR name=day_list></p>
<TMPL_VAR name=content> 
<p class="calendar"><TMPL_VAR name=month_page_list></p>
<p>æœ€çµ‚æ›´æ–°æ™‚é–“: <TMPL_VAR name=lastupdate></p>
<TMPL_VAR name=signature>
</div>
</body></html>
___DAY_PAGE_TEMPLATE
    ;

# ¢¤ÆàÚ¼¸ÎÆó×ì¼È
$item_page_template = << "___PAGE_TEMPLATE"
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<TMPL_IF name=css_file>
 <link rel=stylesheet href="<TMPL_VAR name=css_file>" media=all>
</TMPL_IF>
<link rel="alternate" type="application/rss+xml" title="RSS" href="cl.rdf">
<title><TMPL_VAR name=header_text></title>
</head><body>
<TMPL_IF name=back><a href="<TMPL_VAR name=back>.html">Prev</a></TMPL_IF>
<TMPL_IF name=next> / <a href="<TMPL_VAR name=next>.html">Next</a></TMPL_IF>
/ <a href="index.html"><TMPL_VAR name=cl_name></a>
<h1><TMPL_VAR name=header><TMPL_VAR name=cat></h1>
<div class="day">
<a href="<TMPL_VAR name=ymd>.html"><TMPL_VAR name=ymd></a>
<div class="body">
<!-- start:<TMPL_VAR name=ymdi> -->
<div class="section">
<p><TMPL_VAR name=content></p>
<TMPL_IF name=referrer>
 <div class="referer"><span>Referrer (Inside): 
 <TMPL_VAR name=referrer></span></div>
</TMPL_IF>
<p><a href="<TMPL_VAR name=ymdi>.html">permlink</a></p>
</div>
<!-- end:<TMPL_VAR name=ymdi> -->
</div></div>
<!--<p>last update: <TMPL_VAR name=lastupdate></p>-->
<TMPL_VAR name=signature>
</div></body></html>
___PAGE_TEMPLATE
    ;

# ã‚¢ã‚¤ãƒ†ãƒ ãƒšãƒ¼ã‚¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
#$item_page_template = << "___PAGE_TEMPLATE"

# ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
$cat_page_template = << "TMPL"
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<TMPL_IF name=css_file>
<link rel=stylesheet href="<TMPL_VAR name=css_file>" media=all>
</TMPL_IF>
<link rel="alternate" type="application/rss+xml" title="RSS" href="cl.rdf">
<title><TMPL_VAR name=cat_name> / <TMPL_VAR name=cl_name></title>
</head>
<body>
<a href="index.html">ChangeLog æœ€æ–°ãƒšãƒ¼ã‚¸</a>
<TMPL_IF name=page_list>
 / <a href="<TMPL_VAR name=first_page>">ã‚«ãƒ†ã‚´ãƒªæœ€æ–°ãƒšãƒ¼ã‚¸</a> / 
<TMPL_IF name=back><a href="<TMPL_VAR name=back>">å‰ãƒšãƒ¼ã‚¸</a></TMPL_IF>
<TMPL_VAR name=page_list>
<TMPL_IF name=next><a href="<TMPL_VAR name=next>">æ¬¡ãƒšãƒ¼ã‚¸</a></TMPL_IF>
/ page <TMPL_VAR name=page_id> (<TMPL_VAR name=page_num>)
</TMPL_IF>
<h1><TMPL_VAR name=cat_name> - <a href="index.html"><TMPL_VAR name=cl_name></a></h1>
<div>
æœ€çµ‚æ›´æ–°æ™‚é–“: <TMPL_VAR name=lastupdate>
<TMPL_LOOP name=entries>
<div class="day"><h2><span class="date"><TMPL_VAR name=eh></span></h2>
<div class="body"><TMPL_VAR name=cont></div></div>
</TMPL_LOOP>
<!--<TMPL_VAR name=ym><TMPL_VAR name=day_list>-->
<TMPL_VAR name=signature>
</div></body></html>
TMPL
    ;

# item ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
$item_template = << "EACHITEM"
<!-- start:<TMPL_VAR name=ymdi> -->
<div class="section">
<h3 class="subtitle"><TMPL_VAR name=header> <TMPL_VAR name=cat></h3>
<p><TMPL_VAR name=content>
<TMPL_IF name=readmore>
[ <a href="<TMPL_VAR name=url>">Read More...</a> ]
</TMPL_IF>
</p>
<!--<div class="posted"><span><TMPL_VAR name=author></span></div>-->
<TMPL_IF name=referrer>
<div class="referer"><span>Referrer (Inside): 
<TMPL_VAR name=referrer></span></div>
</TMPL_IF>
<div class="referer"><span>
[ <a href="<TMPL_VAR name=url>">å›ºå®šãƒªãƒ³ã‚¯</a> ]
</span></div>
<!--<TMPL_VAR name=id>-->
</div>
<!-- end:<TMPL_VAR name=ymdi> -->
<!-- ReplaceOnce -->
EACHITEM
    ;

# entry (date) ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
$entry_template = << "DAYENTRY"
<div class="day">
<h2><span class="date"><TMPL_VAR name=header></span></h2>

<div class="body">

<TMPL_IF name=message_top><TMPL_VAR name=message_top></TMPL_IF>

<TMPL_IF name=same_date>
<div class="calendar"><TMPL_VAR name=same_date></div>
</TMPL_IF>

<TMPL_VAR name=content>

<TMPL_IF name=referrer><div class="referer"><span>Referrer (Inside): 
<TMPL_VAR name=referrer></span></div></TMPL_IF>

<TMPL_IF name=message_bottom><TMPL_VAR name=message_bottom></TMPL_IF>
<!--
<div class="comment">
<div class="caption">[
<a href='./kuttukibbs.cgi?id=<TMPL_VAR name=ymd>'>ã‚³ãƒ¡ãƒ³ãƒˆ</a> | 
<a href="tb/tb.cgi?__mode=list&tb_id=<TMPL_VAR name=id>">ãƒˆãƒ©ãƒƒã‚¯ãƒãƒƒã‚¯
(<script language="JavaScript" src="tb/tb_data/<TMPL_VAR name=id>.js">
</script>)</a> ]</div>
<script language="JavaScript" type="text/javascript" 
 src="kblog/<TMPL_VAR name=ymd>.js"></script>
</div>
-->
</div>
</div>
DAYENTRY
    ;


######################################################################
## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

### ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
# usage: {{com('ã“ã‚Œã¯ HTML å¤‰æ›æ™‚ã«å‰Šã‚‰ã‚Œã¾ã™')}}
sub com { }

### clsearch ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ URL ä½œæˆ
# usage: {{clsearch('æµ·è€å æ˜ ç”»é¤¨')}}
# usage: {{clsearch('æµ·è€å æ˜ ç”»é¤¨', 1)}}
sub clsearch {
    my ($k, $mode) = @_;
    my $o = $k;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    $mode = "&mode=$mode" if (defined $mode);
    return qq(<a href="clsearch.cgi?key=$k$mode">$o</a>);
}

### google ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ URL ä½œæˆ
# usage: {{google_search('æµ·è€å æ˜ ç”»é¤¨')}}
sub google_search {
    my ($k) = @_;
    my $o = $k;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    my $c = "ie=EUC-JP&oe=EUC-JP&";
    return qq(<a href="http://www.google.co.jp/search?${c}q=$k">$o</a>);
}

### Bulkfeeds ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
# usage: {{bulkfeeds('æµ·è€å æ˜ ç”»')}}
sub bulkfeeds {
    my ($k) = @_;
    my $o = $k;
    $k = Jcode->new($k)->utf8;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="http://bulkfeeds.net/app/search2?q=$k">$o</a>);
}

### Wiki ã¸ã®ãƒªãƒ³ã‚¯ã®ä½œæˆ
# usage: {{wiki_link('WIKINAME')}}
sub wiki_link {
    my ($k, $o) = @_;
    my $prefix = "http://nais.to/hiki/hiki.cgi?";
    $o = $k if (not defined $o);
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    return qq(<a href="$prefix$k">$o</a>);
}

### amazon ãƒªãƒ³ã‚¯ã®ä½œæˆ
# usage: {{amazon('ASIN', 'STR')}}
sub amazon {
    my ($asin, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
#    my $suffix = "";
    my $suffix = "ytoshomepage-22/ref=nosim"; # ã‚¢ã‚½ã‚·IDä½¿ç”¨æ™‚
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br>/gm;
    $str =~ s/<br>\Z//m;
    return qq(<a href="$prefix/$asin/$suffix">$str</a>);
}

### bk1 ãƒªãƒ³ã‚¯ã®ä½œæˆ - ISBNæ¤œç´¢
# usage: {{bk1('ISBN')}}
sub bk1 {
    my ($isbn) = @_;
    my $aid = "p-137467927";
    return qq(<a href="http://breeder.bk1.jp/rd/$isbn/$aid/noentry"
	      target="_blank">[bk1]</a>);
}

sub az {amazon(@_)}
sub azs {amazon_search(@_)}
sub bf {bulkfeeds(@_)}
sub cls {clsearch(@_)}
sub gs {google_search(@_)}

### amazon ã‚µãƒ¼ãƒçµæœãƒªãƒ³ã‚¯ã®ä½œæˆ
# usage: {{amazon_search('STR' [,'MODE'])}}
sub amazon_search {
    my ($str, $mode) = @_;
    my $k = Jcode->new($str)->utf8;
    $k =~ s/([^0-9a-z_ ])/'%'.unpack('H2', $1)/gei;
    $k =~ s/\s/+/g;
    my $aid = "ytoshomepage-22";
    $mode = "blended" if not defined $mode;
    return '<a href="http://www.amazon.co.jp/exec/obidos/external-search'.
        "?tag=$aid&keyword=$k&mode=$mode\">$str</a>";
}

### æ™®é€šã® amazon ã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã®ä½œæˆ
# usage: {{amazon_link('ASIN', 'ID', 'STR')}}
sub amazon_link {
    my ($asin, $id, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br>/gm;
    $str =~ s/<br>\Z//m;
    return qq(<a href="$prefix/$asin/$id/ref=nosim">$str</a>);
}

### å¾Œã‚ã‚ãŸã„ amazon ã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã®ä½œæˆ
# ref. <http://nais.to/~yto/clog/2003-11-06.html#2003-11-06-2>
# usage: {{qualmish_amazon_link('ASIN', 'ID', 'STR')}}
sub qualmish_amazon_link {
    my ($asin, $id, $str) = @_;
    my $prefix = "http://www.amazon.co.jp/exec/obidos/ASIN";
    $str =~ s/(\s|^)(\S+\.(jpg|jpeg|png|gif))/$1<img src="$2">/gi;
    $str =~ s/$/<br>/gm;
    $str =~ s/<br>\Z//m;
    return qq(<a href="$prefix/$asin/$id/ref=nosim" 
	      onMouseOver="window.status='$prefix/$asin'; return true;"
	      onMouseOut="window.status=''; return true;">$str</a>);
}

### URL ã‚’çŸ­ãè¡¨ç¤º
# usage: {{shorten_url('http://example.com/abc/def/00101033/
# 0123456/aaaaaaaaaaaa/aaaaaaaaaaaa/index.html')}}
sub shorten_url {
    my ($url, $max) = @_;
    $max = 60 if not defined $max;
    $url =~ s/\s+//gsm;
    my $urlstr = $url;
    $urlstr =~ s/^(.{$max}).+$/$1 .../;
    return qq(<a href="$url">$urlstr</a>);
}

### ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯
# usage: {{cat('ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°')}}
sub cat {
    my ($cn) = @_;
    my $url = get_category_filename($cn);
    return qq(<a href="$url">$cn</a>);
}
